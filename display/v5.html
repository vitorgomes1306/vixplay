<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="stylev5.css">

</head>

<body>
    <!-- div oculta para exibir key -->
    <div id="keyRegistrationContainer">
        <div id="keyRegistrationBox">
            Chave de acesso<br>
            <span id="keySpan"></span>
            <!-- Aqui vem a chave -->

        </div>
    </div>

    <!-- div para mostrar carregamento das m√≠dias -->
    <div id="carregandoMidias" style="display: none;">
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 9999;">
            <div style="text-align: center; color: white; font-family: Arial, sans-serif;">
                <div style="font-size: 24px; margin-bottom: 20px;">Carregando M√≠dias...</div>
                <div id="progressoCarregamento" style="font-size: 16px; margin-bottom: 10px;">0%</div>
                <div style="width: 300px; height: 20px; background: #333; border-radius: 10px; overflow: hidden;">
                    <div id="barraProgresso" style="width: 0%; height: 100%; background: linear-gradient(90deg, #007bff, #0056b3); transition: width 0.3s ease;"></div>
                </div>
                <div id="statusCarregamento" style="font-size: 14px; margin-top: 10px; color: #ccc;">Preparando...</div>
            </div>
        </div>
    </div>

    <div id="carregandoMidias">

        carregando midias
    </div>

    <!-- div oculta para exibir play de midias -->
    <div id="mediaPlayContainer">
        <div class="container">
            <div class="superior" id="superiorContainer">
                <!-- Conte√∫do da Div Superior (90%) -->
                <!-- player de video em javascript -->

                <div id="video-container"></div>

                <video id="player" autoplay muted playsinline preload="auto"
                    style="width:100%; height:100%; object-fit:cover; background:black; display:none;">
                </video>

                <script>
                    // Vari√°vel playlist para armazenar os resultados do objeto medias do JSON
                    let playlist = [];
                    let preloadedVideos = [];
                    let currentIndex = 0;
                    const player = document.getElementById("player");

                    // Fun√ß√£o para mostrar/esconder div de carregamento
                    function showLoadingDiv(show) {
                        const loadingDiv = document.getElementById('carregandoMidias');
                        loadingDiv.style.display = show ? 'block' : 'none';
                    }

                    // Fun√ß√£o para atualizar progresso do carregamento
                    function updateLoadingProgress(current, total, status) {
                        const progressPercent = Math.round((current / total) * 100);
                        document.getElementById('progressoCarregamento').textContent = `${progressPercent}%`;
                        document.getElementById('barraProgresso').style.width = `${progressPercent}%`;
                        document.getElementById('statusCarregamento').textContent = status;
                    }

                    // Fun√ß√£o para pr√©-carregar uma m√≠dia no cache
                    function preloadVideo(mediaUrl, mediaName) {
                        return new Promise((resolve, reject) => {
                            console.log(`üîç Tentando carregar: ${mediaName} | URL: ${mediaUrl}`);
                            
                            // Configura√ß√µes espec√≠ficas para Windows
                            const video = document.createElement('video');
                            video.preload = 'metadata'; // Carrega metadados para melhor performance no Windows
                            video.muted = true;
                            video.controls = false;
                            video.setAttribute('webkit-playsinline', 'true');
                            video.setAttribute('playsinline', 'true');
                            video.setAttribute('disablePictureInPicture', 'true');
                            // Configura√ß√µes para evitar travamentos no Windows
                            video.style.objectFit = 'contain';
                            video.crossOrigin = 'anonymous';
                            
                            let hasResolved = false;
                            let loadTimeout;
                            
                            // Fun√ß√£o para limpar e resolver
                            const cleanupAndResolve = (result) => {
                                if (!hasResolved) {
                                    hasResolved = true;
                                    if (loadTimeout) clearTimeout(loadTimeout);
                                    resolve(result);
                                }
                            };
                            
                            // Fun√ß√£o para limpar e rejeitar
                            const cleanupAndReject = (error) => {
                                if (!hasResolved) {
                                    hasResolved = true;
                                    if (loadTimeout) clearTimeout(loadTimeout);
                                    reject(error);
                                }
                            };
                            
                            // Timeout de 15 segundos
                            loadTimeout = setTimeout(() => {
                                console.error(`‚è∞ Timeout ao carregar: ${mediaName}`);
                                cleanupAndReject(new Error('Timeout'));
                            }, 15000);
                            
                            // Event listener para quando os metadados s√£o carregados
                            video.addEventListener('loadedmetadata', () => {
                                console.log(`‚úÖ Metadados carregados: ${mediaName} | Dura√ß√£o: ${video.duration}s`);
                                
                                // Detectar orienta√ß√£o da m√≠dia
                                const isVerticalMedia = video.videoHeight > video.videoWidth;
                                video.mediaOrientation = isVerticalMedia ? 'vertical' : 'horizontal';
                                
                                console.log(`üìê Orienta√ß√£o da m√≠dia ${mediaName}: ${video.mediaOrientation} (${video.videoWidth}x${video.videoHeight})`);
                                
                                cleanupAndResolve(video);
                            });
                            
                            // Event listener para erros
                            video.addEventListener('error', (e) => {
                                console.error(`‚ùå Erro ao carregar m√≠dia: ${mediaName}`);
                                console.error(`‚ùå URL: ${mediaUrl}`);
                                
                                if (video.error) {
                                    console.error(`‚ùå C√≥digo do erro: ${video.error.code}`);
                                    console.error(`‚ùå Mensagem do erro: ${video.error.message}`);
                                    
                                    switch(video.error.code) {
                                        case 1:
                                            console.error('‚ùå MEDIA_ERR_ABORTED: Carregamento abortado pelo usu√°rio');
                                            break;
                                        case 2:
                                            console.error('‚ùå MEDIA_ERR_NETWORK: Erro de rede durante o download');
                                            break;
                                        case 3:
                                            console.error('‚ùå MEDIA_ERR_DECODE: Erro ao decodificar o arquivo');
                                            break;
                                        case 4:
                                            console.error('‚ùå MEDIA_ERR_SRC_NOT_SUPPORTED: Formato de arquivo n√£o suportado');
                                            break;
                                        default:
                                            console.error('‚ùå Erro desconhecido');
                                    }
                                }
                                
                                cleanupAndReject(new Error(`Erro ao carregar ${mediaName}: ${video.error ? video.error.message : 'Erro desconhecido'}`));
                            });
                            
                            // Event listener para in√≠cio do carregamento
                            video.addEventListener('loadstart', () => {
                                console.log(`üîÑ Iniciando carregamento: ${mediaName}`);
                            });
                            
                            // Definir a fonte e iniciar o carregamento
                            console.log(`üé¨ Definindo src para: ${mediaUrl}`);
                            video.src = mediaUrl;
                            
                            // For√ßar o carregamento dos metadados
                            video.load();
                        });
                    }

                    // Fun√ß√£o para testar se a API est√° acess√≠vel
                    async function testApiConnection() {
                        try {
                            // Testa um endpoint real da API em vez de um diret√≥rio de arquivos
                            const testUrl = `${DISPLAY_CONFIG.API_BASE_URL}/public/device/check-device`;
                            console.log(`üîç Testando conex√£o com API: ${testUrl}`);
                            
                            const response = await fetch(testUrl, { 
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ deviceKey: 'test' })
                            });
                            console.log(`üì° Status da API: ${response.status}`);
                            // Considera sucesso se a API responder (mesmo que seja erro 400/404)
                            return response.status < 500;
                        } catch (error) {
                            console.error('‚ùå Erro ao conectar com a API:', error);
                            return false;
                        }
                    }

                    // Fun√ß√£o para testar se um arquivo espec√≠fico existe
                    async function testFileExists(fileUrl) {
                        try {
                            console.log(`üîç Verificando se arquivo existe: ${fileUrl}`);
                            const response = await fetch(fileUrl, { method: 'HEAD' });
                            console.log(`üìÑ Status do arquivo: ${response.status}`);
                            return response.ok;
                        } catch (error) {
                            console.error(`‚ùå Erro ao verificar arquivo: ${fileUrl}`, error);
                            return false;
                        }
                    }

                    // Fun√ß√£o para pr√©-carregar todas as m√≠dias
                    async function preloadAllVideos() {
                        if (playlist.length === 0) {
                            console.log('Playlist vazia, nada para carregar');
                            return;
                        }

                        // Testa conex√£o com API primeiro
                        const apiConnected = await testApiConnection();
                        if (!apiConnected) {
                            console.error('‚ùå API n√£o est√° acess√≠vel. Verifique se o servidor est√° rodando.');
                            updateLoadingProgress(0, playlist.length, 'Erro: API n√£o acess√≠vel');
                            return;
                        }

                        showLoadingDiv(true);
                        updateLoadingProgress(0, playlist.length, 'Iniciando carregamento...');
                        
                        preloadedVideos = [];
                        
                        for (let i = 0; i < playlist.length; i++) {
                            const media = playlist[i];
                            const mediaUrl = media.url; // Usa a URL original da API
                            const mediaName = media.name || media.filename || `M√≠dia ${i + 1}`;
                            
                            console.log(`üîç Processando m√≠dia ${i + 1}/${playlist.length}:`, {
                                filename: media.filename,
                                name: media.name,
                                type: media.type,
                                duration: media.duration,
                                url: mediaUrl
                            });
                            
                            try {
                                updateLoadingProgress(i, playlist.length, `Carregando: ${mediaName}`);
                                
                                // Testa se o arquivo existe primeiro
                                const fileExists = await testFileExists(mediaUrl);
                                if (!fileExists) {
                                    console.error(`‚ùå Arquivo n√£o encontrado: ${mediaUrl}`);
                                    preloadedVideos.push(null);
                                    continue;
                                }
                                
                                const preloadedVideo = await preloadVideo(mediaUrl, mediaName);
                                preloadedVideos.push(preloadedVideo);
                                updateLoadingProgress(i + 1, playlist.length, `Carregado: ${mediaName}`);
                            } catch (error) {
                                console.error(`Erro ao carregar ${mediaName}:`, error);
                                // Continua mesmo com erro
                                preloadedVideos.push(null);
                            }
                        }
                        
                        updateLoadingProgress(playlist.length, playlist.length, 'Carregamento conclu√≠do!');
                        
                        setTimeout(() => {
                            showLoadingDiv(false);
                            console.log(`üé¨ Todas as m√≠dias carregadas! Iniciando reprodu√ß√£o...`);
                            startPlayback();
                        }, 1000);
                    }

                    // Fun√ß√£o para carregar e reproduzir v√≠deos na tela
                    function loadVideo(index) {
                        console.log(`üîç DEBUG loadVideo - Iniciando com √≠ndice: ${index}`);
                        console.log(`üîç DEBUG loadVideo - preloadedVideos.length: ${preloadedVideos.length}`);
                        console.log(`üîç DEBUG loadVideo - playlist.length: ${playlist.length}`);
                        
                        if (preloadedVideos.length === 0) {
                            console.log('‚ùå V√≠deos n√£o foram pr√©-carregados ainda...');
                            return;
                        }

                        const preloadedVideo = preloadedVideos[index];
                        console.log(`üîç DEBUG loadVideo - preloadedVideo:`, preloadedVideo);
                        
                        if (!preloadedVideo) {
                            console.log(`‚ùå V√≠deo pr√©-carregado n√£o encontrado no √≠ndice: ${index}`);
                            return;
                        }

                        const media = playlist[index];
                        console.log(`üîç DEBUG loadVideo - media:`, media);
                        console.log(`‚ñ∂Ô∏è Reproduzindo m√≠dia ${index + 1}/${playlist.length}:`, media.name || media.filename);
                        
                        // Verifica o estado atual do player
                        console.log(`üîç DEBUG player - readyState: ${player.readyState}`);
                        console.log(`üîç DEBUG player - networkState: ${player.networkState}`);
                        console.log(`üîç DEBUG player - paused: ${player.paused}`);
                        console.log(`üîç DEBUG player - currentSrc antes: ${player.currentSrc}`);
                        
                        // Configura√ß√µes espec√≠ficas para Windows para evitar travamentos
                        player.preload = "auto";
                        player.setAttribute('webkit-playsinline', 'true');
                        player.setAttribute('playsinline', 'true');
                        
                        // Copia o v√≠deo pr√©-carregado para o player principal
                        player.src = preloadedVideo.src;
                        console.log(`üîç DEBUG player - src definido como: ${player.src}`);
                        
                        // Aplicar orienta√ß√£o baseada no formato do dispositivo e da m√≠dia
                        const deviceFormat = window.deviceFormat || 'HORIZONTAL';
                        const mediaOrientation = preloadedVideo.mediaOrientation || 'horizontal';
                        
                        // Remove classes anteriores
                        player.classList.remove('vertical-media', 'horizontal-media');
                        
                        // Aplica classe baseada na orienta√ß√£o da m√≠dia
                        if (mediaOrientation === 'vertical') {
                            player.classList.add('vertical-media');
                        } else {
                            player.classList.add('horizontal-media');
                        }
                        
                        console.log(`üîÑ Aplicando orienta√ß√£o: Device=${deviceFormat}, Media=${mediaOrientation}`);
                        
                        // For√ßa o carregamento do v√≠deo
                        player.load();
                        
                        player.currentTime = 0;
                        console.log(`üîç DEBUG player - currentTime resetado para: ${player.currentTime}`);
                        
                        // Mostra o player antes de tentar reproduzir
                        player.style.display = "block";
                        console.log(`üîç DEBUG player - display definido como: ${player.style.display}`);
                        
                        // Adiciona listeners para detectar travamentos no Windows
                        const handleStalled = () => {
                            console.log('‚ö†Ô∏è V√≠deo travado, tentando recuperar...');
                            player.load();
                            setTimeout(() => player.play().catch(console.error), 100);
                        };
                        
                        const handleWaiting = () => {
                            console.log('‚è≥ V√≠deo aguardando buffer...');
                        };
                        
                        player.addEventListener('stalled', handleStalled, { once: true });
                        player.addEventListener('waiting', handleWaiting, { once: true });
                        
                        console.log(`üîç DEBUG player - load() chamado`);
                        
                        // Aguarda um pouco antes de tentar reproduzir
                        setTimeout(() => {
                            console.log(`üé¨ Tentando reproduzir: ${media.name || media.filename}`);
                            console.log(`üîç DEBUG player - readyState ap√≥s load: ${player.readyState}`);
                            
                            const playPromise = player.play();
                            
                            if (playPromise !== undefined) {
                                playPromise.then(() => {
                                    console.log(`‚úÖ Reprodu√ß√£o iniciada com sucesso: ${media.name || media.filename}`);
                                }).catch(err => {
                                    console.error(`‚ùå Erro no autoplay de ${media.name || media.filename}:`, err);
                                    console.error(`‚ùå Tipo do erro:`, err.name);
                                    console.error(`‚ùå Mensagem do erro:`, err.message);
                                    
                                    // Tenta reproduzir sem som como fallback
                                    console.log(`üîÑ Tentando fallback com muted...`);
                                    player.muted = true;
                                    const mutedPlayPromise = player.play();
                                    
                                    if (mutedPlayPromise !== undefined) {
                                        mutedPlayPromise.catch(err2 => {
                                            console.error(`‚ùå Erro mesmo com muted:`, err2);
                                            console.error(`‚ùå Tipo do erro muted:`, err2.name);
                                            console.error(`‚ùå Mensagem do erro muted:`, err2.message);
                                        });
                                    }
                                });
                            } else {
                                console.log(`‚ö†Ô∏è play() n√£o retornou uma Promise`);
                            }
                        }, 100);
                    }

                    // Fun√ß√£o para iniciar a reprodu√ß√£o ap√≥s pr√©-carregamento
                    function startPlayback() {
                        if (preloadedVideos.length > 0) {
                            console.log('üé¨ Iniciando reprodu√ß√£o autom√°tica da playlist...');
                            currentIndex = 0;
                            
                            // Inicia reprodu√ß√£o autom√°tica imediatamente
                            setTimeout(() => {
                                console.log('üîÑ Iniciando reprodu√ß√£o autom√°tica...');
                                loadVideo(currentIndex);
                            }, 500);
                        } else {
                            console.error('‚ùå Nenhum v√≠deo pr√©-carregado dispon√≠vel para reprodu√ß√£o');
                        }
                    }

                    // Fun√ß√£o para inicializar a playlist com dados da API
                    function initializePlaylist(medias) {
                        console.log('üîç Debug - Dados recebidos da API:', medias);
                        
                        // Filtra apenas v√≠deos da lista de m√≠dias e extrai filename da URL
                        playlist = medias.filter(media => media.type === 'VIDEO').map(media => {
                            // Extrai o filename da URL completa
                            const urlParts = media.url.split('/');
                            const filename = urlParts[urlParts.length - 1];
                            
                            return {
                                ...media,
                                filename: filename,
                                name: media.title || media.name || filename
                            };
                        });
                        
                        console.log(`üìã Playlist inicializada com ${playlist.length} v√≠deo(s):`);
                        playlist.forEach((media, index) => {
                            console.log(`üîç Debug - M√≠dia ${index + 1}:`, media);
                            console.log(`${index + 1}. Nome: ${media.name} | Arquivo: ${media.filename} | Dura√ß√£o: ${media.duration}s`);
                        });

                        // Inicia o pr√©-carregamento se houver v√≠deos
                        if (playlist.length > 0) {
                            preloadAllVideos();
                        } else {
                            console.log('‚ùå Nenhum v√≠deo encontrado na playlist');
                        }
                    }

                    // Event listener removido - o player ser√° mostrado diretamente na fun√ß√£o loadVideo

                    // Quando acabar, passa para o pr√≥ximo
                    player.addEventListener("ended", () => {
                        console.log(`üîÑ V√≠deo ${currentIndex + 1} terminou, passando para o pr√≥ximo...`);
                        currentIndex = (currentIndex + 1) % playlist.length; // volta pro primeiro no fim
                        console.log(`‚û°Ô∏è Pr√≥ximo v√≠deo: √≠ndice ${currentIndex + 1}/${playlist.length}`);
                        loadVideo(currentIndex);
                    });
                    
                    // Adiciona listener para monitorar o tempo do v√≠deo
                    player.addEventListener("timeupdate", () => {
                        const media = playlist[currentIndex];
                        if (media && media.duration) {
                            // Se o v√≠deo passou do tempo definido na API, passa para o pr√≥ximo
                            if (player.currentTime >= media.duration) {
                                console.log(`‚è∞ Tempo limite atingido (${media.duration}s), passando para pr√≥ximo v√≠deo...`);
                                player.currentTime = 0;
                                currentIndex = (currentIndex + 1) % playlist.length;
                                loadVideo(currentIndex);
                            }
                        }
                    });
                    
                    // Adiciona listener para quando o v√≠deo est√° pronto para reproduzir
                    player.addEventListener("canplay", () => {
                        console.log(`‚úÖ V√≠deo ${currentIndex + 1} est√° pronto para reproduzir`);
                    });
                    
                    // Adiciona listener para quando o v√≠deo come√ßa a reproduzir
                    player.addEventListener("playing", () => {
                        console.log(`‚ñ∂Ô∏è V√≠deo ${currentIndex + 1} est√° reproduzindo`);
                    });
                    
                    // Adiciona listener para quando o v√≠deo pausa
                    player.addEventListener("pause", () => {
                        console.log(`‚è∏Ô∏è V√≠deo ${currentIndex + 1} foi pausado`);
                    });
                    
                    // Adiciona listener para erros durante a reprodu√ß√£o
                    player.addEventListener("error", (e) => {
                        console.error(`‚ùå Erro durante reprodu√ß√£o do v√≠deo ${currentIndex + 1}:`, e);
                        console.error(`‚ùå Detalhes do erro:`, player.error);
                        // Tenta passar para o pr√≥ximo v√≠deo em caso de erro
                        setTimeout(() => {
                            currentIndex = (currentIndex + 1) % playlist.length;
                            loadVideo(currentIndex);
                        }, 1000);
                    });

                    // Fun√ß√£o para reiniciar a playlist (√∫til para atualiza√ß√µes)
                    function restartPlaylist() {
                        if (preloadedVideos.length > 0) {
                            currentIndex = 0;
                            loadVideo(currentIndex);
                        }
                    }
                </script>


            </div>
            <div class="inferior">
                <span style="color: aliceblue;">ANUNCIE AQUI</span>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script>

        // Fun√ß√£o para gerar fingerprint √∫nico do navegador
        function generateBrowserFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('Browser fingerprint', 2, 2);

            const fingerprint = [
                navigator.userAgent,
                navigator.language,
                screen.width + 'x' + screen.height,
                screen.colorDepth,
                new Date().getTimezoneOffset(),
                canvas.toDataURL()
            ].join('|');

            return fingerprint;
        }

        // Fun√ß√£o para converter string em hash simples
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // Convert to 32bit integer
            }
            return Math.abs(hash);
        }

        // Fun√ß√£o para gerar chave √∫nica e imut√°vel por navegador
        function generateUniqueKey() {
            // Primeiro tenta recuperar do localStorage
            let deviceKey = localStorage.getItem('vix_device_key');

            if (!deviceKey) {
                // Se n√£o existe, gera baseado no fingerprint do navegador
                const fingerprint = generateBrowserFingerprint();
                const hash = simpleHash(fingerprint);

                // Converte hash em chave de 6 caracteres
                const characters = 'ABCDEF123456789';
                let key = '';
                let tempHash = hash;

                for (let i = 0; i < 6; i++) {
                    key += characters.charAt(tempHash % characters.length);
                    tempHash = Math.floor(tempHash / characters.length);
                }

                deviceKey = key;

                // Salva no localStorage para persist√™ncia
                localStorage.setItem('vix_device_key', deviceKey);
                console.log('Nova chave gerada e salva:', deviceKey);
            } else {
                console.log('Chave recuperada do localStorage:', deviceKey);
            }

            return deviceKey;
        }

        // Fun√ß√£o para exibir a chave na div
        function displayKey() {
            const key = generateUniqueKey();
            const keyBox = document.getElementById('keyRegistrationBox');
            keyBox.innerHTML = `
                <h2>Chave de Registro do Dispositivo</h2>
                <div style="font-size: 24px; font-weight: bold; color: #007bff; margin: 20px 0; letter-spacing: 2px;">${key}</div>
                <p>Use esta chave para registrar o dispositivo no sistema</p>
                <small style="color: #666; font-size: 12px;">Esta chave √© √∫nica e permanente para este navegador</small>
            `;
        }

        // Fun√ß√£o para verificar chave na API
        async function checkDeviceKey(deviceKey) {
            try {
                const apiUrl = `${DISPLAY_CONFIG.API_BASE_URL}/public/device/${deviceKey}`;
                console.log('Verificando chave na API:', apiUrl);

                const response = await fetch(apiUrl);
                console.log('Status da resposta:', response.status);

                if (response.ok) {
                    const data = await response.json();
                    console.log('Dados recebidos da API:', data);
                    return { found: true, data: data };
                } else {
                    console.log('Chave n√£o encontrada na API');
                    return { found: false, data: null };
                }
            } catch (error) {
                console.error('Erro ao verificar chave na API:', error);
                return { found: false, data: null };
            }
        }

        // Fun√ß√£o para controlar visibilidade das divs
        function toggleDisplays(showPlayer) {
            const keyContainer = document.getElementById('keyRegistrationContainer');
            const mediaContainer = document.getElementById('mediaPlayContainer');
            const loadingContainer = document.getElementById('carregandoMidias');

            if (showPlayer) {
                // Chave encontrada - ocultar registro e loading, mostrar player
                keyContainer.style.display = 'none';
                loadingContainer.style.display = 'none';
                mediaContainer.style.display = 'flex';
                console.log('Chave encontrada - exibindo player');
            } else {
                // Chave n√£o encontrada - mostrar registro, ocultar player e loading
                keyContainer.style.display = 'flex';
                mediaContainer.style.display = 'none';
                loadingContainer.style.display = 'none';
                console.log('Chave n√£o encontrada - exibindo registro');
            }
        }

        // Fun√ß√£o para configurar layout baseado no formato do dispositivo
        function configureDeviceLayout(deviceFormat) {
            const container = document.querySelector('.container');
            const body = document.body;

            console.log(`üñ•Ô∏è Configurando layout para formato: ${deviceFormat}`);

            // Remove classes anteriores
            container.classList.remove('vertical', 'horizontal');
            body.classList.remove('device-vertical', 'device-horizontal');

            if (deviceFormat === 'VERTICAL') {
                // Layout vertical: m√≠dias "em p√©"
                container.classList.add('vertical');
                body.classList.add('device-vertical');
                console.log('üì± Layout configurado para VERTICAL (m√≠dias em p√©)');
            } else {
                // Layout horizontal: m√≠dias "deitadas" (padr√£o)
                container.classList.add('horizontal');
                body.classList.add('device-horizontal');
                console.log('üñ•Ô∏è Layout configurado para HORIZONTAL (m√≠dias deitadas)');
            }

            // Armazenar formato do dispositivo para uso posterior
            window.deviceFormat = deviceFormat;
        }

        // Fun√ß√£o principal para inicializar a aplica√ß√£o
        async function initializeApp() {
            const deviceKey = generateUniqueKey();

            // Primeiro exibe a chave
            displayKey();

            // Depois verifica na API
            const result = await checkDeviceKey(deviceKey);

            // Se o dispositivo foi encontrado, armazena os dados
            if (result.found && result.data) {
                console.log('üì± Dados do dispositivo:', result.data.device);
                console.log('üì∫ Dados do painel:', result.data.panel);

                // Armazena os dados do dispositivo globalmente para uso posterior
                window.deviceData = result.data.device;
                window.panelData = result.data.panel;

                console.log(`‚úÖ Dispositivo "${result.data.device.name}" conectado com sucesso!`);
                console.log(`üìã Painel: "${result.data.panel.name}" com ${result.data.panel.medias.length} m√≠dia(s)`);

                // Configurar layout baseado no formato do dispositivo
                const deviceFormat = result.data.device.format || 'HORIZONTAL';
                configureDeviceLayout(deviceFormat);

                // Inicializar playlist com os dados das m√≠dias da API
                if (result.data.panel && result.data.panel.medias) {
                    console.log('üé¨ Inicializando playlist com dados da API...');
                    initializePlaylist(result.data.panel.medias);
                } else {
                    console.log('‚ö†Ô∏è Nenhuma m√≠dia encontrada no painel');
                }
            }

            // Controla a visibilidade das divs baseado no resultado
            toggleDisplays(result.found);
        }

        // Executar quando a p√°gina carregar
        window.addEventListener('load', initializeApp);


    </script>
</body>

</html>